- name: Add vs code-insiders repo
  community.general.zypper_repository:
    repo: "https://packages.microsoft.com/yumrepos/vscode"
    autorefresh: yes
    enabled: yes
    name: vscode
    state: present
    auto_import_keys: yes
    disable_gpg_check: yes

- name: Add nvidia repo
  community.general.zypper_repository:
    repo: "https://download.nvidia.com/opensuse/tumbleweed"
    autorefresh: yes
    enabled: yes
    name: nvidia
    state: present
    auto_import_keys: yes
    disable_gpg_check: no

# - name: Add zsh-autosuggestions repo
#   community.general.zypper_repository:
#     repo: "https://download.opensuse.org/repositories/shells:/zsh-users:/zsh-autosuggestions/openSUSE_Tumbleweed/"
#     autorefresh: yes
#     enabled: yes
#     name: zsh-autosuggestions
#     state: present
#     auto_import_keys: yes
#     disable_gpg_check: no

# - name: Add zsh-syntax-highlighting repo
#   community.general.zypper_repository:
#     repo: "https://download.opensuse.org/repositories/shells:/zsh-users:/zsh-syntax-highlighting/openSUSE_Tumbleweed/"
#     autorefresh: yes
#     enabled: yes
#     name: zsh-syntax-highlighting
#     state: present
#     auto_import_keys: yes
#     disable_gpg_check: no

- name: Perform a dist-upgrade
  community.general.zypper:
    name: "*"
    state: dist-upgrade
    allow_vendor_change: true
    extra_args: "--allow-arch-change"
  notify: reboot

- name: Install zypper packages
  community.general.zypper:
    name: "{{ packages }}"
    state: latest
    update_cache: yes
  vars:
    packages:
      - bat
      - bc
      - broot
      - crun
      - git
      - git-lfs
      - ranger
      - zstd
      - neovim
      - dolphin-plugins
      - ripgrep
      - fzf
      - zsh
      - fd
      - fzf-zsh-completion
      # - fd-zsh-completion
      # - zsh-autosuggestions
      # - zsh-syntax-highlighting
      # - ripgrep-zsh-completion
      - flatpak
      - NetworkManager-vpnc
      - vpnc
      - latte-dock
      - code-insiders
      - filelight
      - kvantum-manager
      - kvantum-qt6
      - cockpit
      - cockpit-bridge
      - cockpit-machines
      - cockpit-networkmanager
      - cockpit-packagekit
      - cockpit-podman
      - cockpit-storaged
      - cockpit-system
      - cockpit-ws
      - exa
      - neofetch
      - virt-manager
      - vagrant
      - vagrant-libvirt
      - sshpass
      - qemu-hw-display-qxl
      - gnome-keyring
      - virt-viewer
      # - plasma5-systemmonitor
      - minikube
      - kubernetes-client
      - helm
      - k9s
      - compsize
      - x11-video-nvidiaG05
      - dnsmasq
      - v4l-utils
      - podman
  notify: reboot

- name: Uninstall unnecessary zypper packages
  community.general.zypper:
    name: "{{ packages }}"
    state: absent
    update_cache: true
  vars:
    packages:
      - MozillaFirefox
      - MozillaFirefox-branding-openSUSE
      - patterns-games-games
      - patterns-kde-kde_games
      - kdegames-carddecks-default
      - libkdegames
      - libkdegames-lang
      - libkf5kdegames6
      - skanlite
      - skanlite-lang
      - konversation
      - konversation-lang
      - akregator
      - akregator-lang
      - tigervnc
      - libvlc5
      - libvlccore9
      - vlc
      - vlc-codec-gstreamer
      - vlc-lang
      - vlc-noX
      - vlc-qt
      - vlc-vdpau
      - kate
      - kate-lang
      - kate-plugins
      - libkate1
      - liboggkate1
      - spectacle
      - spectacle-lang
  notify: reboot

- name: Enable services
  ansible.builtin.systemd:
    state: started
    daemon_reload: true
    enabled: true
    name: "{{ services }}"
  with_items:
    - cockpit.socket
    - libvirtd.service
  loop_control:
    loop_var: services
